<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>領養</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.2/echarts.min.js" integrity="sha512-VdqgeoWrVJcsDXFlQEKqE5MyhaIgB9yXUVaiUa8DR2J4Lr1uWcFm+ZH/YnzV5WqgKf4GPyHQ64vVLgzqGIchyw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <div id="chart" style = "width:800px; height: 400px;"></div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
  <script>
   var url="https://data.coa.gov.tw/Service/OpenData/TransService.aspx?UnitId=DyplMIk3U1hf";
  
   var dataArray =[];
   var monthArray = []; 
   var adoptArray =[];
   var percentArray = [];
   var year = 0;
   var city = '';
   fetch(url,{
        method:"GET",
    }).then(response=>{
        return response.json();
    }).then(json =>{
      year = 111; // 年份
      city = 'City000003'; // 縣市代碼
      
      json.forEach(element => {
        if(element.rpt_year==year  && element.rpt_country_code==city){
            dataArray.push(element);
        }
      });
      monthArray = dataArray.map(item =>{
            return item.rpt_month
      })
      adoptArray =dataArray.map(item =>{
            return item.adopt_num
      })
      percentArray =dataArray.map(item =>{
            return parseInt(item.adopt_rate.replace('%',''))
      })
      console.log("monthArray", monthArray);
      console.log("adoptArray", adoptArray);
      console.log("percentArray", percentArray);
      // if needed -> bubble sort
      for (var i = 0; i <monthArray.length; i++) {
        for (var j = 0; j < (monthArray.length - i - 1); j++) {
            // Checking if the item at present iteration 
            // is greater than the next iteration
            if (monthArray[j] > monthArray[j + 1]) {
                // If the condition is true
                // then swap them
                var temp = monthArray[j]
                var temp_1 = adoptArray[j]
                var temp_2 =  percentArray[j]
                monthArray[j] = monthArray[j + 1]
                adoptArray[j] =adoptArray[j + 1]
                percentArray[j] = percentArray[j + 1]
                monthArray[j + 1] = temp
                adoptArray[j + 1] = temp_1
                percentArray[j + 1] = temp_2
            }
        }
      }
            
      console.log("monthArray_sort", monthArray);
      console.log("adoptArray_sort", adoptArray);
      console.log("percentArray_sort", percentArray);
    var myChart = echarts.init(document.getElementById("chart"));
    // 圖表設定與資料
    var option = {
        title:{
            text : "收容機構領養",
        },
        tooltip:{
            trigger:"axis",
        }, 
        legend : {
            data:["領養隻數","領養率"],
        }, 
        xAxis: {
            type :"category", 
            data : monthArray ,
            name:"月份"
        }, 
        yAxis :[{
            type:"value",
            name:"領養隻數" ,
            position :'right',
            axisLabel: {
              formatter: '{value} 隻'
            } 
        },{
            type:"value",
            name:"領養率" ,
            position :'left',
            axisLabel: {
              formatter: '{value} %'
            } 
        }], 
        series:
        [{
            name:"領養隻數", 
            type:"bar", 
            data:adoptArray,
        },,
        {
          name: "領養率",
          type: 'line',
          yAxisIndex: 1,
          data: percentArray
      }]
    };

    myChart.setOption(option);
   }).catch(error =>{
     console.log(error);
   })
 
  </script>
</body>
</html>