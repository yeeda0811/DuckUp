<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECharts</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.2/echarts.min.js" integrity="sha512-VdqgeoWrVJcsDXFlQEKqE5MyhaIgB9yXUVaiUa8DR2J4Lr1uWcFm+ZH/YnzV5WqgKf4GPyHQ64vVLgzqGIchyw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <div id="chart" style = "width:800px; height: 400px;"></div>
  <script>
    var DogArray =[];
    var DogVariety =[]
    var Dog_count =[]
    var Dog_obj = []
    var Dog_item = []
    var url="https://data.coa.gov.tw/Service/OpenData/TransService.aspx?UnitId=QcbUEzN6E6DL";
    fetch(url,{
        method:"GET",
    }).then(response=>{
        return response.json();
    }).then(json =>{
        const regex = new RegExp('2023');
        json.forEach(element => {
            if(element.animal_kind=="狗"&& regex.test(element.animal_createtime)){
                DogArray.push(element);
            }
        });
         DogVariety= DogArray.map(item =>{
            return item.animal_Variety.trim()
        })
        console.log("DogVariety", DogVariety);

        Dog_count = DogVariety.reduce((obj,item)=>{
        if (item in obj) {
            obj[item]++
        } else {
            obj[item] = 1
        }
            return obj
        },{})
        console.log("Dog count",Dog_count);
        Dog_obj = Object.keys(Dog_count);
        Dog_num = Object.values(Dog_count);
        // 處理空字串 
        console.log("Dog_obj",Dog_obj);
        console.log("Dog_num",Dog_num);
        var myChart = echarts.init(document.getElementById("chart"));
        // 圖表設定與資料
        var option = {
            title:{
                text : "領養狗2023",
            },
            tooltip:{
                trigger:"item",
                formatter : "{a} <br/> {b}: {c} ({d}%)",
                // a,  ,b, c, d 有特殊對應名稱
                // a = 資料所屬系列名稱
                // b = 資料項的名稱
                // c = 資料項的數值 
                // d = 資料項的佔比 
            }, 
            legend : {
                orient:"vertical",
                left:10, 
                top:30, 
                data: Dog_obj ,
            },
            series:[{
                name:"訪問來源", 
                type:"pie", 
                radius:["40%", "70%"], // 內半徑、外半徑 ->甜甜圈
                label:{
                    show:false, 
                    position:"center",
                },
                // spootlight -> 選取項目 name出現在中間
                emphasis:{
                    label:{
                        show:true,
                        fontSize:"25px", 
                        fontWeight:"bold", 
                    }
                },
                data:[
                    {value: Dog_num[0], name:Dog_obj[0]}, 
                    {value: Dog_num[1], name:Dog_obj[1]}, 
                    {value: Dog_num[2], name:Dog_obj[2]}, 
                    {value: Dog_num[3], name:Dog_obj[3]}, 
                    {value: Dog_num[4], name:Dog_obj[4]}, 
                    {value: Dog_num[5], name:Dog_obj[5]}, 
                    {value: Dog_num[6], name:Dog_obj[6]}, 
                    {value: Dog_num[7], name:Dog_obj[7]}, 
                    {value: Dog_num[8], name:Dog_obj[8]}, 
                    {value: Dog_num[9], name:Dog_obj[9]}, 
                    {value: Dog_num[10], name:Dog_obj[10]}, 
                    {value: Dog_num[11], name:Dog_obj[11]}, 
                    {value: Dog_num[12], name:Dog_obj[12]}, 
                    {value: Dog_num[13], name:Dog_obj[13]}, 
                    {value: Dog_num[14], name:Dog_obj[14]}, 
                    {value: Dog_num[15], name:Dog_obj[15]}, 
                    {value: Dog_num[16], name:Dog_obj[16]}, 
                    {value: Dog_num[17], name:Dog_obj[17]}, 
                    {value: Dog_num[18], name:Dog_obj[18]}, 
                    {value: Dog_num[19], name:Dog_obj[19]}, 
                    {value: Dog_num[20], name:Dog_obj[20]}, 
                    {value: Dog_num[21], name:Dog_obj[21]}, 
                    {value: Dog_num[22], name:Dog_obj[22]}, 
                    {value: Dog_num[23], name:Dog_obj[23]}, 
                    {value: Dog_num[24], name:Dog_obj[24]}, 
                    {value: Dog_num[25], name:Dog_obj[25]}, 
                    {value: Dog_num[26], name:Dog_obj[26]}, 
                ]
            }],
        };
        myChart.setOption(option);
        }).catch(error =>{
            console.log(error);
        })
  </script>
</body>
</html>